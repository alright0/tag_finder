# tag_finder
Тестовое задание: поиск вложенных тегов в html странице на flask 

Реализовать RESTful-сервис который позволит реализовать следующий сценарий: 
1. Внешний пользователь вызывает endpoint в который передаёт произвольный URL адрес. Его запросу присваивается некоторый уникальный идентификатор. 
2. Пользователь может передавать этот идентификатор в endpoint получения результатов обработки. Если обработка завершена, пользователь должен получить количество уникальных тегов в документе, с количеством “вложенных” в него элементов. Например: {“html”: {“count”:1, “nested”:100}, “body”:{“count”:1, “nested”:99}, “H1”: {“count”:2,”nested”:0}. 
3. Входящие данные должны валидироваться, ошибки доступности URL, ответа внешних серверов и т.д. обрабатываться. 

<b>1. Внешний пользователь вызывает endpoint в который передаёт произвольный URL адрес. Его запросу присваивается некоторый уникальный идентификатор.</b><br>
<b>2. Пользователь может передавать этот идентификатор в endpoint получения результатов обработки. Если обработка завершена, пользователь должен получить количество уникальных тегов в документе, с количеством “вложенных” в него элементов. Например: {“html”: {“count”:1, “nested”:100}, “body”:{“count”:1, “nested”:99}, “H1”: {“count”:2,”nested”:0}.</b>

api имеет два эндпоинта:
/api/send - принимает json в post-запросе вида {"link" : "https://urllink/"} 
/api/<int:link_id> - принимает get-запрос без параметров(основным параметром является уникальный номер ссылки, который передается в endpoint) и возвращает данные из БД по виду 

Чтобы отправить запрос через тестовый клиент flask, необходимо сделать следующие шаги:
1. Открыть cmd и перейти в директорию расположения проекта: ``cd path/to/dir``
2. Вызвать интерпретатор: ``python``
![1](https://user-images.githubusercontent.com/71926912/118775954-232ec080-b890-11eb-8380-069e78ca9a51.PNG)

3. Импортировать клиент: ``from app import client``
![2](https://user-images.githubusercontent.com/71926912/118776157-5a04d680-b890-11eb-9c8b-ad7558b78b37.PNG)

Отправка ссылки:
Отправить запрос следующего вида: ``result = client.post("/api/send", json={"link": "https://github.com/"})``
![3](https://user-images.githubusercontent.com/71926912/118776375-99cbbe00-b890-11eb-83a4-f912dff6d3eb.PNG)<br>
Чтобы проверить статус запроса необходимо вызвать переменную result, которая вернет http-статус запроса
Чтобы получить ответ сервера, необходимо воспользоваться методом ``result.get_json()``, который вернет ответ вида {'id': 21, 'link': 'https://github.com/'}

Получение списка тегов:
чтобы получить информацию об уникальных тегах на сайте, необходимо через клиент перейти на адрес /api/<int:link_id>. Пример: /api/22, /api/3
``res = client.get("/api/21")``
![4](https://user-images.githubusercontent.com/71926912/118778269-96393680-b892-11eb-9f65-5f655d921fcc.PNG)
просмотр ответа сервера теми же вызовами: ``res`` и ``res.get_json()``

<b>3. Входящие данные должны валидироваться, ошибки доступности URL, ответа внешних серверов и т.д. обрабатываться.</b>

Валидация входящих данных осуществляется через flask-apispec: схема входящих данных передается через декораторы @use_kwargs и @marshal_with. 
При передаче невалидых данных возвращается http-статус "422 Unprocessable Entity". 
Все http-коды перехватываются хэндлером и возвращаю json вида {"error": error_description}
Все внутренние ошибки перехватываются через try-except внутри функции роутинга и возвращают json такого же вида как и http-статусы: {"error": error_description}
![5](https://user-images.githubusercontent.com/71926912/118781161-6b041680-b895-11eb-9081-fe53fa7735a0.PNG)

<b>Плюсом будет: 
Реализация docker файла для запуска 
Реализация UI для сервиса 
Генерация документации для созданных методов 
Покрытие тестами 
Любые улучшения которые вы считаете необходимыми </b>

Из дополнений я добавил Генерацию документации с помощью swagger и реализацию UI(браузерная)

Авматизированная документация реализована с помощью swagger и swagger-ui, в которой я описал только api-методы. Я мало работал со сваггером, поэтому, считаю, что это место можно и доработать.
![6](https://user-images.githubusercontent.com/71926912/118781992-51170380-b896-11eb-831e-375cde315d20.PNG)

UI построенный на flask-wtforms, jinja2. я не стал добавлять оформление, поскольку ограничен во времени.
Отправка ссылок: 
![30](https://user-images.githubusercontent.com/71926912/118782451-c8e52e00-b896-11eb-98fb-0edde3255da5.PNG)
отправка доступна по адресу: ``/`` и ``/index``
Валидация данных осуществляется через wtforms и принимает только url
при вводе неправильного значения выдает всплывающие сообщения или возвращает ID, по которому можно получить теги
Неправильный ввод:
![7](https://user-images.githubusercontent.com/71926912/118783008-5294fb80-b897-11eb-8d8a-e5e92438debd.PNG)

Правильный ввод:
![8](https://user-images.githubusercontent.com/71926912/118783051-5fb1ea80-b897-11eb-96fb-2b0db370451e.PNG)

получение тегов:
![4](https://user-images.githubusercontent.com/71926912/118783351-a7d10d00-b897-11eb-868a-bb77550fe387.PNG)
Получение списка тегов доступно по адресу ``/tags``

Валидация также через wtforms. В случае ошибок возвращается код и описание
